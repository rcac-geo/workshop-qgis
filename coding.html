<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Hands-on QGIS on HPC Clusters: Coding</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/rcac/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/rcac/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/rcac/favicon-16x16.png"><link rel="manifest" href="favicons/rcac/site.webmanifest"><link rel="mask-icon" href="favicons/rcac/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav rcac"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="rcac-logo" alt="Lesson Description" src="assets/images/rcac-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/coding.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav rcac" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/rcac-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Hands-on QGIS on HPC Clusters
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Hands-on QGIS on HPC Clusters
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Hands-on QGIS on HPC Clusters
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 68%" class="percentage">
    68%
  </div>
  <div class="progress rcac">
    <div class="progress-bar rcac" role="progressbar" style="width: 68%" aria-valuenow="68" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/coding.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="project.html">2. Project</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Coding
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#qgis-python-console">QGIS Python Console</a></li>
<li><a href="#using-processing-from-the-command-line">Using processing from the command line</a></li>
<li><a href="#coding-with-standalone-python">Coding with Standalone Python</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="project.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="project.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Project
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Coding</h1>
        <p>Last updated on 2025-03-11 |

        <a href="https://github.com/rcac-geo/workshop-qgis/edit/main/episodes/coding.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What is QGIS Python Console?</li>
<li>How to automate geospatial tasks with QGIS?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Demonstrate how to use QGIS Python Console.</li>
<li>Demonstrate how to automate QGIS tasks using Python coding and
processing from the command line.</li>
<li>Demonstrate how to monitor CPU and memory usage.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="qgis-python-console">QGIS Python Console<a class="anchor" aria-label="anchor" href="#qgis-python-console"></a></h2>
<hr class="half-width"><ul><li><p>The QGIS Python Console is an interactive shell for Python
command executions.</p></li>
<li><p>It also has a Python file editor that allows you to edit and save
your Python scripts.</p></li>
<li>
<p>Modules from QGIS (analysis, core, gui, server, processing, 3d)
and Qt (QtCore, QtGui, QtNetwork, QtWidgets, QtXml) as well as Python’s
math, os, re and sys modules are already imported and can be used
directly.</p>
<p>The screenshots below show how to open QGIS Python Console, and how
it looks like.</p>
</li>
</ul><figure><img width="595" alt="Screenshot 2025-03-04 at 10 58 51 AM" src="https://github.com/user-attachments/assets/3157328b-18c8-43bf-b0a7-a434496de234" class="figure mx-auto d-block"></figure><figure><img width="1048" alt="Screenshot 2025-03-04 at 11 00 04 AM" src="https://github.com/user-attachments/assets/79248436-7123-46cc-814c-d09074375c7f" class="figure mx-auto d-block"></figure><p>Let’s create an output directory through Terminal, you should replace
trainXX with your training account.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> /scratch/negishi/trainXX/project/code_output</span></code></pre>
</div>
<p>Let’s copy the code below to the python console.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># change work directory</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>path <span class="op">=</span><span class="st">"/scratch/negishi/trainXX/project/code_output"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>os.chdir(path)</span></code></pre>
</div>
<div class="section level3">
<h3 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a></h3>
<p>You can load data in two ways, depending on if you want it on the
QGIS map canvas. Choose the first method if you only require
computation; select the second if visualization is also needed.</p>
<div class="section level4">
<h4 id="the-first-way">The first way<a class="anchor" aria-label="anchor" href="#the-first-way"></a></h4>
<p>There are two steps to load data.</p>
<ul><li><p>Step 1: data is loaded in memory.</p></li>
<li><p>Step 2: the data is added to QGIS map canvas. This is not
necessary if you just do computation and do not visualize data.</p></li>
</ul><div class="section level5">
<h5 id="load-vector-data">(1) Load Vector Data<a class="anchor" aria-label="anchor" href="#load-vector-data"></a></h5>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>vectorfile <span class="op">=</span><span class="st">"/scratch/negishi/liu4201/project/output/stream10_6.geojson"</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># The format is:</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># vlayer = QgsVectorLayer(data_source, layer_name, provider_name)</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>vlayer <span class="op">=</span> QgsVectorLayer(vectorfile, <span class="st">"stream10_6"</span>, <span class="st">"ogr"</span>)</span></code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>When you create a QgsVectorLayer or QgsRasterLayer object, it’s just
a layer in memory. It doesn’t automatically get added to the QGIS map
canvas. You have more control over the layer’s properties and how it’s
loaded. You can even choose to not load it. You can also set things like
the layer’s CRS, geometry type, and other options before adding it to
the map.</p>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> vlayer.isValid():</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Layer failed to load!"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    QgsProject.instance().addMapLayer(vlayer) <span class="co"># load the layer</span></span></code></pre>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler2" aria-labelledby="headingSpoiler2">
<div class="accordion-body">
<p>Now it gets added to the QGIS map canvas.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level5">
<h5 id="load-raster-data">(2) Load Raster Data<a class="anchor" aria-label="anchor" href="#load-raster-data"></a></h5>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># use the firt way to load rasterfile 1</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># load raster to memory</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>path_to_tif <span class="op">=</span> rasterpath <span class="op">+</span> <span class="st">"USGS_1M_16_x50y448_IN_Indiana_Statewide_LiDAR_2017_B17.tif"</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>rlayer <span class="op">=</span> QgsRasterLayer(path_to_tif, <span class="st">"dem"</span>)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># added raster to the QGIS map canvas</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> rlayer.isValid():</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Layer failed to load!"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    QgsProject.instance().addMapLayer(rlayer) <span class="co"># load the layer</span></span></code></pre>
</div>
</div>
</div>
<div class="section level4">
<h4 id="the-second-way">The second way<a class="anchor" aria-label="anchor" href="#the-second-way"></a></h4>
<p>It loads a vector or raster layer and immediately adds it to the map
canvas</p>
<div class="section level5">
<h5 id="load-vector-data-1">(1) Load Vector Data<a class="anchor" aria-label="anchor" href="#load-vector-data-1"></a></h5>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>vlayer <span class="op">=</span> iface.addVectorLayer(vectorfile, <span class="st">"stream10_6"</span>, <span class="st">"ogr"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> vlayer:</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Layer failed to load!"</span>)</span></code></pre>
</div>
</div>
<div class="section level5">
<h5 id="load-raster-data-1">(2) Load Raster Data<a class="anchor" aria-label="anchor" href="#load-raster-data-1"></a></h5>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">#use the second way to load rasterfile 2</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>path_to_tif2 <span class="op">=</span> rasterpath <span class="op">+</span> <span class="st">"USGS_1M_16_x50y449_IN_Indiana_Statewide_LiDAR_2017_B17.tif"</span>   </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>iface.addRasterLayer(path_to_tif2, <span class="st">"dem2"</span>)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="merge-dem-data">Merge DEM Data<a class="anchor" aria-label="anchor" href="#merge-dem-data"></a></h3>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>rlayer <span class="op">=</span> QgsRasterLayer(path_to_tif, <span class="st">"dem"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>rlayer2 <span class="op">=</span> QgsRasterLayer(path_to_tif2, <span class="st">"dem2"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Merge rasters</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>processing.run(<span class="st">"gdal:merge"</span>, {<span class="st">"INPUT"</span>: [rlayer, rlayer2], <span class="st">"OUTPUT"</span>: <span class="st">"merged_dem.tif"</span>})</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#check the merged_dem</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>iface.addRasterLayer(<span class="st">"merged_dem.tif"</span>,<span class="st">"merged_dem"</span>)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="calculate-slope">Calculate Slope<a class="anchor" aria-label="anchor" href="#calculate-slope"></a></h3>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Calcualting slope</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>processing.run(<span class="st">"qgis:slope"</span>, {<span class="st">"INPUT"</span>: <span class="st">"merged_dem.tif"</span>, <span class="st">"OUTPUT"</span>: <span class="st">"slope.tif"</span>})</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#check it </span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>iface.addRasterLayer(<span class="st">"slope.tif"</span>,<span class="st">"slope"</span>)</span></code></pre>
</div>
<p>You may wonder how to easily write the python code to perform tasks.
Well, QGIS provide a smart way.</p>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Hint </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler3" aria-labelledby="headingSpoiler3">
<div class="accordion-body">
<p>Step 1: Search the processing in the Processing Toolbox with QGIS
interface, and fill in all the parameters.</p>
<p>Step 2: Click “Advanced”, and select “Copy as Python Command”.</p>
<p>Step 3: Paste it to run in the python console.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="calculate-hillshade">Calculate Hillshade<a class="anchor" aria-label="anchor" href="#calculate-hillshade"></a></h3>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>processing.run(<span class="st">"native:hillshade"</span>, {<span class="st">'INPUT'</span>:<span class="st">'merged_dem.tif'</span>,<span class="st">'Z_FACTOR'</span>:<span class="dv">1</span>,<span class="st">'AZIMUTH'</span>:<span class="dv">300</span>,<span class="st">'V_ANGLE'</span>:<span class="dv">40</span>,<span class="st">'OUTPUT'</span>:<span class="st">'hillshade.tif'</span>})</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="using-processing-from-the-command-line">Using processing from the command line<a class="anchor" aria-label="anchor" href="#using-processing-from-the-command-line"></a></h2>
<hr class="half-width"><p>QGIS includes the Processing Executor, a command-line tool that
enables the execution of QGIS processing algorithms and models,
including those from plugins, outside of the QGIS Desktop interface.</p>
<p>To use it, Let first close QGIS application, and then we will submit
a job to HPC Cluster.</p>
<ul><li>Step 1: Let’s start a new file named “myhydrojob” and copy in the
code below.</li>
</ul><div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#!/bin/sh -l</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co"># FILENAME:  myjob10_4</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#SBATCH -A workshop</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#SBATCH --nodes=1</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#SBATCH --ntasks=1</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=8 </span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#SBATCH --time=00:10:00</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#SBATCH --job-name myhydro_job</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#SBATCH --output=/home/liu4201/jobs/hydro10_4.out    ## replace with your own path</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#SBATCH --error=/home/liu4201/jobs/hydro10_4.out     ## replace with your own path</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="ex">module</span> reset</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="ex">module</span> load qgis</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="ex">module</span> load monitor</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="bu">export</span> <span class="va">QT_QPA_PLATFORM</span><span class="op">=</span>offscreen</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="ex">monitor</span> cpu percent <span class="at">--sample-rate</span> 10 <span class="at">--total</span> <span class="op">&gt;</span> cpu.log <span class="kw">&amp;</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="ex">monitor</span> cpu memory <span class="at">--sample-rate</span> 10 <span class="at">--actual</span> <span class="at">-H</span> <span class="op">&gt;</span> mem.log <span class="kw">&amp;</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="va">workdir</span><span class="op">=</span>/scratch/negishi/liu4201/project/code_output  <span class="co">## replace with your own path</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="ex">qgis_process</span> run wbt:FillDepressionsWangAndLiu  <span class="at">--</span> dem=<span class="va">$workdir</span>/merged_dem.tif output=<span class="va">$workdir</span>/fillsinks.tif</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="ex">qgis_process</span> run wbt:D8Pointer  <span class="at">--</span> dem=<span class="va">$workdir</span>/fillsinks.tif output=<span class="va">$workdir</span>/flowdirect.tif</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="ex">qgis_process</span> run wbt:D8FlowAccumulation <span class="at">--distance_units</span><span class="op">=</span>meters <span class="at">--area_units</span><span class="op">=</span>m2 <span class="at">--ellipsoid</span><span class="op">=</span>EPSG:7030 <span class="at">--input</span><span class="op">=</span><span class="va">$workdir</span>/flowdirect.tif <span class="at">--out_type</span><span class="op">=</span>0 <span class="at">--log</span><span class="op">=</span>false <span class="at">--clip</span><span class="op">=</span>false <span class="at">--pntr</span><span class="op">=</span>true <span class="at">--esri_pntr</span><span class="op">=</span>false <span class="at">--output</span><span class="op">=</span><span class="va">$workdir</span>/flowaccum.tif</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="ex">qgis_process</span> run wbt:ExtractStreams <span class="at">--distance_units</span><span class="op">=</span>meters <span class="at">--area_units</span><span class="op">=</span>m2 <span class="at">--ellipsoid</span><span class="op">=</span>EPSG:7030 <span class="at">--flow_accum</span><span class="op">=</span><span class="va">$workdir</span>/flowaccum.tif <span class="at">--threshold</span><span class="op">=</span>10000 <span class="at">--zero_background</span><span class="op">=</span>false <span class="at">--output</span><span class="op">=</span><span class="va">$workdir</span>/stream10_4.tif</span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="ex">qgis_process</span> run wbt:Subbasins <span class="at">--distance_units</span><span class="op">=</span>meters <span class="at">--area_units</span><span class="op">=</span>m2 <span class="at">--ellipsoid</span><span class="op">=</span>EPSG:7030 <span class="at">--d8_pntr</span><span class="op">=</span><span class="va">$workdir</span>/flowdirect.tif <span class="at">--streams</span><span class="op">=</span><span class="va">$workdir</span>/stream10_4.tif <span class="at">--esri_pntr</span><span class="op">=</span>false <span class="at">--output</span><span class="op">=</span><span class="va">$workdir</span>/subbasins10_4.tif</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="ex">qgis_process</span> run wbt:WetnessIndex <span class="at">--distance_units</span><span class="op">=</span>meters <span class="at">--area_units</span><span class="op">=</span>m2 <span class="at">--ellipsoid</span><span class="op">=</span>EPSG:7030 <span class="at">--sca</span><span class="op">=</span><span class="va">$workdir</span>/subbasins10_4.tif <span class="at">--slope</span><span class="op">=</span><span class="va">$workdir</span>/slope.tif <span class="at">--output</span><span class="op">=</span><span class="va">$workdir</span>/wetnessIndex10_4.tif</span></code></pre>
</div>
<div id="accordionSpoiler4" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler4" aria-expanded="false" aria-controls="collapseSpoiler4">
  <h3 class="accordion-header" id="headingSpoiler4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Hint </h3>
</button>
<div id="collapseSpoiler4" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler4" aria-labelledby="headingSpoiler4">
<div class="accordion-body">
<p>Step 1: Search the processing in the Processing Toolbox with QGIS
interface, and fill in all the parameters.</p>
<p>Step 2: Click “Advanced”, and select “Copy as qgis_process
Command”.</p>
<p>Step 3: Paste it to run in the job script.</p>
</div>
</div>
</div>
</div>
<ul><li>Step 2: Then we could submit the job with typing the code below in
Terminal.</li>
</ul><div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">sbatch</span> myhydrojob</span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>monitor is a module to monitor your resources, such as cpu and
memory. You can look up for help after loading the module, as below.</p>
<p>To look up help for “monitor”, after “module load monitor”, run</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">monitor</span> <span class="at">--help</span></span></code></pre>
</div>
<p>To look up help for “qgis_process”, after “module load qgis”, run</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">qgis_process</span> <span class="at">--help</span></span></code></pre>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="coding-with-standalone-python">Coding with Standalone Python<a class="anchor" aria-label="anchor" href="#coding-with-standalone-python"></a></h2>
<hr class="half-width"><p>Now let’s experiment on a different Channelization Threshold, 10,000
by coding with standalone Python Script.</p>
<ul><li>Step 1: Start a new python script named “hydro_10_5.py” and copy in
the code below. You should replace the path with your own where it is
noted.</li>
</ul><div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="im">from</span> qgis.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># initialize qgis</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>qgs_app <span class="op">=</span> QgsApplication([], <span class="va">False</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>qgs_app.initQgis()</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#add whiteboxTools path</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>module_path <span class="op">=</span> <span class="st">"/home/liu4201/apps/qgis_tools/WhiteboxTools_linux_amd64/WBT"</span> <span class="co">## replace with your own path</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>sys.path.append(module_path)</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#import processing tools</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="im">import</span> whitebox <span class="im">as</span> wbtool</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#from qgis import processing</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#from processing.core.Processing import Processing</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#Processing.initialize()</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co"># change work directory</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>path <span class="op">=</span><span class="st">"/scratch/negishi/liu4201/project/code_output/"</span>  <span class="co">## replace with your own path</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>os.chdir(path)</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co">#for alg in QgsApplication.processingRegistry().algorithms():</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="co">#    print(alg.id(), "-&gt;", alg.displayName())</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>wbt <span class="op">=</span> wbtool.WhiteboxTools()</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="co">#processing.run("native:hillshade", {'INPUT':'merged_dem.tif','Z_FACTOR':1,'AZIMUTH':300,'V_ANGLE':40,'OUTPUT':'hillshade.tif'})</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>wbt.extract_streams(flow_accum <span class="op">=</span> path <span class="op">+</span> <span class="st">"flowdirect.tif"</span>,</span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>                   threshold<span class="op">=</span><span class="dv">100000</span>,</span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a>                   zero_background<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a>                   output<span class="op">=</span> path <span class="op">+</span> <span class="st">"stream10_5.tif"</span>)</span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a>wbt.subbasins(d8_pntr<span class="op">=</span> path <span class="op">+</span> <span class="st">"flowdirect.tif"</span>, streams<span class="op">=</span> path <span class="op">+</span> <span class="st">"stream10_5.tif"</span>,esri_pntr<span class="op">=</span><span class="va">False</span>, output<span class="op">=</span> path <span class="op">+</span> <span class="st">"subbasins10_5.tif"</span>)</span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a>wbt.wetness_index(sca<span class="op">=</span> path <span class="op">+</span> <span class="st">"subbasins10_5.tif"</span>, slope<span class="op">=</span> path <span class="op">+</span> <span class="st">"slope.tif"</span>, output<span class="op">=</span> path <span class="op">+</span> <span class="st">"wetnessIndex10_5.tif"</span>)</span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a>qgs_app.exitQgis()</span></code></pre>
</div>
<div id="accordionSpoiler5" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler5" aria-expanded="false" aria-controls="collapseSpoiler5">
  <h3 class="accordion-header" id="headingSpoiler5">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler5" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler5" aria-labelledby="headingSpoiler5">
<div class="accordion-body">
<p>Note 1: Refer <a href="https://www.whiteboxgeo.com/manual/wbt_book/available_tools/index.html" class="external-link">WhiteBoxTools
User Manual</a> for the code to use the algorithm, “Copy as Python
Command” provided by QGIS does not match the real WhiteBoxTools
algorithms.</p>
<p>Note 2: Refer to the code commented out in the snippet to use
processing tools provided by QGIS (for example, native:hillshade). To
highlight, it’s necessary to include the code below in the right
place.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">from</span> qgis <span class="im">import</span> processing</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="im">from</span> processing.core.Processing <span class="im">import</span> Processing</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>Processing.initialize()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<ul><li>Step 2: Start a file named “myjob10_5” and copy the code below in.
You should replace the path with your own where it is noted in
parenthesis.</li>
</ul><div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">#!/bin/sh -l</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="co"># FILENAME:  myjob10_5</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#SBATCH -A workshop</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#SBATCH --nodes=1</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#SBATCH --ntasks=1</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=8 </span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#SBATCH --time=00:10:00</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#SBATCH --job-name myhydro_job</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#SBATCH --output=/home/liu4201/jobs/hydro10_5.out  ## replace with your own path</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#SBATCH --error=/home/liu4201/jobs/hydro10_5.out   ## replace with your own path</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="ex">module</span> reset</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="ex">module</span> load qgis</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="ex">module</span> load monitor</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="bu">export</span> <span class="va">QT_QPA_PLATFORM</span><span class="op">=</span>offscreen</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="ex">monitor</span> cpu percent <span class="at">--sample-rate</span> 10 <span class="at">--total</span> <span class="op">&gt;</span> cpu1.log <span class="kw">&amp;</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="ex">monitor</span> cpu memory <span class="at">--sample-rate</span> 10 <span class="at">--actual</span> <span class="at">-H</span> <span class="op">&gt;</span> mem1.log <span class="kw">&amp;</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="ex">python</span> /home/liu4201/qgis_data/code/hydro_10_5.py  <span class="co">## replace with your own path</span></span></code></pre>
</div>
<ul><li>Step 3: Submit your job via running the code below in terminal.</li>
</ul><div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">sbatch</span> myjob</span></code></pre>
</div>
<div id="accordionSpoiler6" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler6" aria-expanded="false" aria-controls="collapseSpoiler6">
  <h3 class="accordion-header" id="headingSpoiler6">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler6" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler6" aria-labelledby="headingSpoiler6">
<div class="accordion-body">
<p>The export QT_QPA_PLATFORM=offscreen command tells Qt (the GUI
framework used by QGIS) to use the “offscreen” platform plugin.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>To automate geospatial tasks with QGIS algorithms, we can use three
coding approaches: the QGIS Python Console, standalone Python scripts,
and command-line execution.</li>
<li>For QGIS Python Console, data can be loaded in two ways depending on
whether you want to add it to the QGIS map canvas.</li>
<li>Standalone Python scripts and command-line execution allow us to
submit jobs to HPC clusters, enabling enhanced automation of QGIS
geospatial tasks.</li>
<li>We monitor CPU and memory usage within jobs to guide our computation
resource requests.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="project.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="project.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Project
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/rcac-geo/workshop-qgis/edit/main/episodes/coding.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/rcac-geo/workshop-qgis/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/rcac-geo/workshop-qgis/" class="external-link">Source</a></p>
				<p><a href="https://github.com/rcac-geo/workshop-qgis/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:rcac-help@purdue.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/aseetharam/varnish/tree/db4f5c6f3c4799dfe8247fd057642c8099d5244b" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://rcac-geo.github.io/workshop-qgis/coding.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "qgis, plugins, python console",
  "name": "Coding",
  "creativeWorkStatus": "active",
  "url": "https://rcac-geo.github.io/workshop-qgis/coding.html",
  "identifier": "https://rcac-geo.github.io/workshop-qgis/coding.html",
  "dateCreated": "2025-02-18",
  "dateModified": "2025-03-11",
  "datePublished": "2025-03-11"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

